<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>最勤奋的前十个导演</title>
    <script src="/static/js/echarts.min.js"></script>
</head>
<body>
<div id="pie-chart" style="height: 600px;"></div>
<script>
    // 初始化 ECharts 实例
    var myChart = echarts.init(document.getElementById('pie-chart'));

    // 读取 CSV 文件
    function readCSV(callback) {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
                callback(xhr.responseText);
            }
        };
        xhr.open('GET', '/csv_files/directors_movies_count.csv', true);
        xhr.send();
    }

    // 处理 CSV 数据并绘制饼图
    readCSV(function (csvData) {
        // 解析 CSV 数据
        var lines = csvData.split('\n');
        var directors = [];
        var movieCounts = [];

        // 只取前十个导演和电影数量
        for (var i = 1; i < Math.min(11, lines.length); i++) {
            var parts = lines[i].split(',');
            directors.push(parts[0]);
            movieCounts.push(parseInt(parts[1]));
        }

        // 指定饼图的配置项和数据
        var option = {
            title: {
                text: '最勤奋的前十个导演',
                left: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: '{a} <br/>{b}: {c} ({d}%)'
            },
            legend: {
                orient: 'vertical',
                left: 20,
                data: directors,
                textStyle: { // 设置图例的字体样式
                    fontSize: 12 // 将字体大小调整为 12
                },
            },
            series: [
                {
                    name: 'Movie Count',
                    type: 'pie',
                    radius: ['30%', '60%'],
                    center: ['50%', '50%'],
                    label: {
                        formatter: '{b|{b}}\n{per|{d}%}',
                        rich: {
                            b: {
                                fontSize: 12,
                                lineHeight: 20
                            },
                            per: {
                                fontSize: 14,
                                lineHeight: 20
                            }
                        }
                    },
                    data: directors.map(function (name, index) {
                        return {name: name, value: movieCounts[index]};
                    })
                }
            ]
        };

        // 使用刚指定的配置项和数据显示图表
        myChart.setOption(option);
    });
</script>
</body>
</html>